<!DOCTYPE html>
<html>

<head>
    <!--Importando Bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!--Importando .js e .css pessoal-->
    <script type="text/javascript" src="js/index.js"></script>
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <div id='tela'>
        <br>
        <div>
            <div id='logo'>
                <h1>BLOCK</h1>
                <h1 style="color: rgb(0, 119, 255);">FY</h1>
            </div>
            <div>
                <a href="https://rinkeby.etherscan.io/address/0xe112d8af91bfae454d49a000d2419b3ea18e67af">Rastrear contrato pelo Etherscan</a>
            </div>
            
        </div>
        
        <br>
        <div id='formu'>
            <div class="input-group mb-3">
                <input type="text" placeholder="ID da música" class="form-control" id='txtMscAdd'>
                <input type="text" placeholder="Address do artista" class="form-control" id='txtArtAdd'>
                <div class="input-group-append">
                    <button class="btn btn-info" type="button" id='btnAdd'">Adicionar música</button>
                </div>
            </div>

            <div class=" input-group mb-3">
                        <input type="text" class="form-control" placeholder="ID da música" id='txtListen'>
                        <div class="input-group-append">
                            <button class="btn btn-info" type="button" id="btnListen">Escutar música</button>
                        </div>
                </div>

                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Address do artista" id='txtArt'>
                    <div class="input-group-append">
                        <button class="btn btn-info" type="button" id="btnArt">Estatísticas do artista</button>
                    </div>
                </div>

                <div class="input-group mb-3">
                    <input type="text" class="form-control" id='txtMsc' placeholder="ID da música">
                    <div class="input-group-append">
                        <button id='btnMsc' class="btn btn-info" type="button">Estatísticas da música</button>
                    </div>
                </div> 

                <div class="input-group mb-3">
                    <input type="text" id='txtUsr' class="form-control" placeholder="ID da música">
                    <div class="input-group-append">
                        <button class="btn btn-info" type="button" id='btnUsr'>Suas estatísticas</button>
                    </div>
                </div> <br>
            </div>
        </div>

        <div id='exibidor'>
            <div class="circulo">
                <p id="mensage">O artista foi tocado:</p> <br>
                <div id='e1'>
                    <p class='cont' id='musician'>0</p>
                    <p>vezes</p>
                </div>
            </div>
            <div class="circulo">
                <p id="mensage">A música foi tocada:</p> <br>
                <div id='e2'>
                    <p class='cont' id='music'>0</p>
                    <p>vezes</p>
                </div>
            </div>
            <div class="circulo">
                <p id="mensage">Você ouviu:</p> <br>
                <div id='e3'>
                    <p class='cont' id='user'>0</p>
                    <p>vezes esta música</p>
                </div>
            </div>
            <br>
        </div>

        <!--Importando Web3-->
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>

        <script>
            var contract;

            //ESTATÍSTICAS
            $(document).ready(function () {
                web3 = new Web3(web3.currentProvider);

                var address = "0xE112d8AF91bFAe454d49a000d2419B3EA18E67aF";
                var abi = [
                    {
                        "inputs": [
                            {
                                "internalType": "uint256",
                                "name": "cod_music",
                                "type": "uint256"
                            },
                            {
                                "internalType": "address",
                                "name": "addr_musician",
                                "type": "address"
                            }
                        ],
                        "name": "addMusic",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                    },
                    {
                        "inputs": [
                            {
                                "internalType": "uint256",
                                "name": "cod_music",
                                "type": "uint256"
                            }
                        ],
                        "name": "listenMusic",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                    },
                    {
                        "inputs": [
                            {
                                "internalType": "address",
                                "name": "addr_musician",
                                "type": "address"
                            }
                        ],
                        "name": "musicianStats",
                        "outputs": [
                            {
                                "internalType": "uint256",
                                "name": "qntd",
                                "type": "uint256"
                            }
                        ],
                        "stateMutability": "view",
                        "type": "function"
                    },
                    {
                        "inputs": [
                            {
                                "internalType": "uint256",
                                "name": "cod_music",
                                "type": "uint256"
                            }
                        ],
                        "name": "musicStats",
                        "outputs": [
                            {
                                "internalType": "uint256",
                                "name": "qntd",
                                "type": "uint256"
                            }
                        ],
                        "stateMutability": "view",
                        "type": "function"
                    },
                    {
                        "inputs": [
                            {
                                "internalType": "uint256",
                                "name": "cod_music",
                                "type": "uint256"
                            }
                        ],
                        "name": "userStats",
                        "outputs": [
                            {
                                "internalType": "uint256",
                                "name": "qntd",
                                "type": "uint256"
                            }
                        ],
                        "stateMutability": "view",
                        "type": "function"
                    }
                ];

                contract = new web3.eth.Contract(abi, address);
            })

            //FUNÇÕES
            $('#btnListen').click(function () {
                var cod = 0;
                cod = parseInt($('#txtListen').val());

                web3.eth.getAccounts().then(function (accounts) {
                    var acc = accounts[0];
                    return contract.methods.listenMusic(cod).send({ from: acc });
                }).then(function (tx) {
                    console.log(tx);
                }).catch(function (tx) {
                    console.log(tx);
                })
            })

            $('#btnAdd').click(function () {
                var endereco = 0;
                var idMusica = 0;
                endereco = $('#txtArtAdd').val();
                idMusica = parseInt($('#txtMscAdd').val());

                web3.eth.getAccounts().then(function (accounts) {
                    var acc = accounts[0];
                    return contract.methods.addMusic(idMusica, endereco).send({ from: acc });
                }).then(function (tx) {
                    console.log(tx);
                }).catch(function (tx) {
                    console.log(tx);
                })
            })

            $('#btnArt').click(function () {
                var endereco = 0;
                endereco = $('#txtArt').val();

                web3.eth.getAccounts().then(function (accounts) {
                    var acc = accounts[0];
                    contract.methods.musicianStats(endereco).call().then(function (total) {
                        $('#musician').html(total);
                    })
                }).then(function (tx) {
                    console.log(tx);
                }).catch(function (tx) {
                    console.log(tx);
                })
            })

            $('#btnMsc').click(function () {
                var cod = 0;
                cod = parseInt($('#txtMsc').val());

                web3.eth.getAccounts().then(function (accounts) {
                    var acc = accounts[0];
                    contract.methods.musicStats(cod).call().then(function (musica) {
                        $('#music').html(musica);
                    })
                }).then(function (tx) {
                    console.log(tx);
                }).catch(function (tx) {
                    console.log(tx);
                })
            })

            $('#btnUsr').click(function () {
                var cod = 0;
                cod = parseInt($('#txtUsr').val());

                web3.eth.getAccounts().then(function (accounts) {
                    var acc = accounts[0];
                    contract.methods.userStats(cod).call().then(function (total) {
                        $('#user').html(total);
                    })
                }).then(function (tx) {
                    console.log(tx);
                }).catch(function (tx) {
                    console.log(tx);
                })
            })
        </script>

</body>

</html>